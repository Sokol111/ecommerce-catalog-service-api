// Code generated by openapi-generate, DO NOT EDIT.

package httpapi

import (
	"context"
	"net/http"

	"go.opentelemetry.io/otel/metric"
	"go.opentelemetry.io/otel/trace"

	httpclient "github.com/Sokol111/ecommerce-commons/pkg/http/client"
	"github.com/Sokol111/ecommerce-commons/pkg/security/token"
)

// TokenSecuritySource implements SecuritySource for service-to-service authentication.
type TokenSecuritySource struct {
	token string
}

// NewTokenSecuritySource creates a SecuritySource that uses a static token.
func NewTokenSecuritySource(token string) *TokenSecuritySource {
	return &TokenSecuritySource{token: token}
}

// BearerAuth returns the bearer token for authentication.
func (s *TokenSecuritySource) BearerAuth(_ context.Context, _ OperationName) (BearerAuth, error) {
	return BearerAuth{Token: s.token}, nil
}

// ProvideClient creates a configured API client with all dependencies for fx DI.
func ProvideClient(
	httpClient *http.Client,
	cfg httpclient.Config,
	tokenCfg token.Config,
	tracerProvider trace.TracerProvider,
	meterProvider metric.MeterProvider,
) (*Client, error) {
	return NewClient(
		cfg.BaseURL,
		NewTokenSecuritySource(tokenCfg.ServiceToken),
		WithClient(httpClient),
		WithTracerProvider(tracerProvider),
		WithMeterProvider(meterProvider),
	)
}
